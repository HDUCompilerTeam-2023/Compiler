name: Auto Test CI

on:
  push:
    branches-ignore:
      - 'raspi_log'

jobs:
  test:
    runs-on: self-hosted

    steps:
      - name: Set clang version as clang-10
        run: clang --version

      - name: Fetch Branch
        run: |
          echo "$(pwd)"
          remote_branch="${GITHUB_REF#refs/heads/}"  
          git fetch origin "${remote_branch}"         
          git checkout origin/"${remote_branch}" 
        working-directory: /home/zengyong/actions-runner/_work/Compiler

      - name: Test-release
        run: ./github_ci.sh ./test-results.md
        working-directory: /home/zengyong/actions-runner/_work/Compiler

      - name: Upload Test Artifacts
        uses: actions/upload-artifact@v3
        with:
            name: test-results
            path: /home/zengyong/actions-runner/_work/Compiler/test-results.md

